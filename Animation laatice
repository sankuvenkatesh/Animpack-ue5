bl_info = {
    "name": "Anim Lattice Pro",
    "author": "AniMate Pro Clone", 
    "version": (1, 0, 0),
    "blender": (5, 0, 0),
    "location": "Graph Editor > N Panel > Lattice Pro",
    "description": "AniMate Pro style lattice keyframe tools",
    "category": "Animation",
}

import bpy
from bpy.types import Operator, Panel
from bpy.props import FloatProperty

class ANIMLATTICE_OT_lattice_scale(Operator):
    """AniMate Pro style lattice scaling"""
    bl_idname = "animlattice.lattice_scale"
    bl_label = "Lattice Scale"
    bl_options = {'REGISTER', 'UNDO'}
    
    time_factor: FloatProperty(default=1.0, name="Time")
    value_factor: FloatProperty(default=1.0, name="Value")
    
    def execute(self, context):
        # Use Blender's BUILT-IN graph operators (AniMate Pro method)
        bpy.ops.graph.select_all(action='SELECT')
        bpy.ops.graph.select_border()  # Selects current selection
        
        # Scale using Blender's transform tools
        bpy.ops.graph.scale('INVOKE_DEFAULT', 
            x=self.time_factor, 
            y=self.value_factor)
        
        return {'FINISHED'}

class ANIMLATTICE_OT_retime_pro(Operator):
    """Pro retiming - AniMate Pro style"""
    bl_idname = "animlattice.retime_pro"
    bl_label = "Retime Pro"
    bl_options = {'REGISTER', 'UNDO'}
    
    factor: FloatProperty(default=1.0)
    
    def execute(self, context):
        # AniMate Pro uses constraint horizontal movement
        bpy.ops.graph.select_all(action='SELECT')
        bpy.ops.graph.constraints_clear()
        bpy.ops.graph.stretch(constraint=0.0)  # Lock Y
        bpy.ops.graph.scale(x=self.factor, y=1.0)
        return {'FINISHED'}

class ANIMLATTICE_PT_pro_panel(Panel):
    bl_label = "Lattice Pro"
    bl_idname = "ANIMLATTICE_PT_pro_panel"
    bl_space_type = 'GRAPH_EDITOR'
    bl_region_type = 'UI'
    bl_category = "Lattice Pro"
    
    def draw(self, context):
        layout = self.layout
        
        # Status - shows if in Graph Editor
        if context.space_data.type != 'GRAPH_EDITOR':
            layout.label(text="‚ö†Ô∏è Switch to Graph Editor", icon='ERROR')
            return
        
        layout.label(text="üé¨ AniMate Pro Style", icon='MOD_LATTICE')
        
        # Quick buttons like AniMate Pro
        col = layout.column(align=True)
        
        # Time controls (horizontal)
        box = layout.box()
        box.label(text="‚è±Ô∏è Time (Retime)", icon='TIME')
        row = box.row(align=True)
        row.operator("animlattice.retime_pro", text="0.8x").factor = 0.8
        row.operator("animlattice.retime_pro", text="1.2x").factor = 1.2
        
        # Value controls (vertical)  
        box = layout.box()
        box.label(text="üìà Value (Scale)", icon='GRAPH')
        row = box.row(align=True)
        row.operator("animlattice.lattice_scale", text="0.8x").time_factor = 1.0
        row.operator("animlattice.lattice_scale", text="1.2x").time_factor = 1.0
        row.operator("animlattice.lattice_scale", text="1.2x").value_factor = 1.2
        
        # Lattice transform button
        layout.separator()
        layout.operator("animlattice.lattice_scale", 
                       text="üî≤ Lattice Transform", 
                       icon='MOD_LATTICE')

# Quick preset buttons
class ANIMLATTICE_OT_quick_fast(Operator):
    bl_idname = "animlattice.quick_fast"
    bl_label = "Fast"
    bl_options = {'REGISTER', 'UNDO'}
    
    def execute(self, context):
        bpy.ops.animlattice.retime_pro('INVOKE_DEFAULT', factor=0.7)
        return {'FINISHED'}

class ANIMLATTICE_OT_quick_slow(Operator):
    bl_idname = "animlattice.quick_slow"
    bl_label = "Slow" 
    bl_options = {'REGISTER', 'UNDO'}
    
    def execute(self, context):
        bpy.ops.animlattice.retime_pro('INVOKE_DEFAULT', factor=1.3)
        return {'FINISHED'}

classes = (
    ANIMLATTICE_OT_lattice_scale,
    ANIMLATTICE_OT_retime_pro,
    ANIMLATTICE_PT_pro_panel,
    ANIMLATTICE_OT_quick_fast,
    ANIMLATTICE_OT_quick_slow,
)

def register():
    for cls in classes:
        bpy.utils.register_class(cls)

def unregister():
    for cls in reversed(classes):
        bpy.utils.unregister_class(cls)

if __name__ == "__main__":
    register()
